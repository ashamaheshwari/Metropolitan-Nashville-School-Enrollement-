---
title: "Mid Course Project"
output: html_notebook
---


```{r}
library(tidyverse)
library(sf)
library(leaflet)
library(scales)
library(readxl)
library(htmltools)
library(scales)
```

```{r}
enrollment<- read_csv('Data/enrollment.csv')
school_map_data <- read_csv('Data/School_map_data.csv')
school_map_data <- school_map_data[-c(168,169), ]
school_enrollment <-read_csv('Data/school_enrollment.csv')
```

```{r}
school_map <- st_as_sf(school_map_data, coords =c("LONG_","LAT_"), crs = 4326)
school_map
```


```{r}
MNPS <- st_read("gisMNPS_Schools_2122/gisMNPS_BoE.shp", as_tibble = T, quiet = T)%>%
  st_transform('+proj=longlat +datum=WGS84')
ggplot(MNPS) +
  geom_sf()
MNPS
```

```{r}
school_enrollment$LONGITUDE[(is.na(school_enrollment$LONGITUDE))] <-
 -86.74527
```

```{r}
school_enrollment$LATITUDE[(is.na(school_enrollment$LATITUDE))] <-
 36.23366
```

```{r}
school_enrollment <- st_as_sf(school_enrollment, coords =c("LONGITUDE","LATITUDE"), crs = 4326)
school_enrollment
```

```{r}
map <- leaflet(options = leafletOptions(minZoom = 10)) %>%
  addProviderTiles(provider = "CartoDB.Positron") %>%
  setView(lng = -86.7816, lat = 36.1627, zoom = 12) %>%
  setMaxBounds(lng1 = -86.7816 + 1, 
               lat1 = 36.1627 + 1, 
               lng2 = -86.7816 - 1, 
               lat2 = 36.1627 - 1) %>%
  addCircleMarkers(data = school_enrollment,
                   radius = 3,
                   color = "white",
                   weight = 0.25,
                   fillColor = "red",
                   fillOpacity = 0.75) %>%
addPolygons(data = MNPS,
                   weight = 2,
                   fillOpacity = 0.0)
map
```


```{r}
enrollment %>%
  group_by (years, sl) %>%
  summarise(enrollment = sum(enrollment)) %>%
  ungroup() %>%
  ggplot(aes(x = years, y= enrollment, group = sl, color = sl))+
  geom_line()+
  geom_point()+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        plot.title = element_text(hjust = 0.5),
        legend.position="right", 
        axis.title.y = element_text(size=12, vjust = 3),
        axis.text.y  = element_text(size = 10))+
  ggtitle("Enrollment trends over the years")
  

```


```{r}
#tiff("enrollemnt.tiff", units="in", width=10, height=6, res=300)
school_enrollment %>%
  group_by (YEARS, SCHOOL_TYPE) %>%
  summarise(enrollment = sum(TOTAL_ENROLLMENT)) %>%
  ungroup() %>%
  ggplot(aes(x = YEARS, y= enrollment, group = SCHOOL_TYPE, color = SCHOOL_TYPE))+
  geom_line()+
  geom_point()+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1),
        plot.title = element_text(hjust = 0.5),
        legend.position="right", 
        axis.title.y = element_text(size=12, vjust = 3),
        axis.text.y  = element_text(size = 10))+
  ggtitle("Enrollment trends over the years")
  
```

```{r}

census <- st_read("tl_2022_47_tract 2/tl_2022_47_tract.shp", as_tibble = T, quiet = T) %>%
  st_transform('+proj=longlat +datum=WGS84')
ggplot(census) +
  geom_sf()
census

```

```{r}
map <- leaflet(options = leafletOptions(minZoom = 10)) %>%
  addProviderTiles(provider = "CartoDB.Positron") %>%
  setView(lng = -86.7816, lat = 36.1627, zoom = 12) %>%
  setMaxBounds(lng1 = -86.7816 + 1, 
               lat1 = 36.1627 + 1, 
               lng2 = -86.7816 - 1, 
               lat2 = 36.1627 - 1) %>%
  addCircleMarkers(data = school_enrollment,
                   radius = 3,
                   color = "white",
                   weight = 0.25,
                   fillColor = "red",
                   fillOpacity = 0.75) %>%
addPolygons(data = census,
                   weight = 1,
                   fillOpacity = 0.0) %>%
  addPolygons(data = MNPS,
              color = "green",
                   weight = 3,
                   fillOpacity = 0.0)

map
```

```{r}
enrollment$label <- 
  paste0("<b>School:</b> ", enrollment$school, "<br>",
         "<b>sl:</b> ", enrollment$sl, "<br>", 
         "<b>enrollment:</b> ", enrollment$enrollment) %>%
  lapply(htmltools::HTML)
```

```{r}
map <- leaflet(options = leafletOptions(minZoom = 10)) %>%
  addProviderTiles(provider = "CartoDB.Positron") %>%
  setView(lng = -86.7816, lat = 36.1627, zoom = 12) %>%
  setMaxBounds(lng1 = -86.7816 + 1, 
               lat1 = 36.1627 + 1, 
               lng2 = -86.7816 - 1, 
               lat2 = 36.1627 - 1) %>%
  addCircleMarkers(data = school_map,
                   radius = 1,
                   color = "white",
                   weight = 0.25,
                   fillColor = "red",
                   fillOpacity = 0.75,
                   label = ~label)

map
```

